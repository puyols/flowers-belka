{"name":"checkout\/simplecheckout","before":"\/\/ \u0412\u0430\u0448 api \u043a\u043b\u044e\u0447 \u0438\u0437 \u043b\u043a \u0434\u0430\u0434\u0430\u0442\u044b https:\/\/dadata.ru\/#registration_popup\nvar token = \"1e2eed7c6325a2e85c4da766c68785235836613b\";\n\/\/ \u0414\u043b\u044f \u0431\u043b\u043e\u043a\u0430 \u0430\u0434\u0440\u0435\u0441\u0441\nfunction checkAddress($city, $address, $postcode, $region) {\n  \/\/ \u0415\u0441\u043b\u0438 \u0438\u043d\u043f\u0443\u0442 \u0433\u043e\u0440\u043e\u0434\u0430 \u043d\u0435\u0442\u0443 \u0432\u044b\u0445\u043e\u0434\u0438\u043c\n    if (!$city.length) return;\n    var type = 'ADDRESS';\n    $city.suggestions({\n        token: token,\n        type: type,\n        bounds: \"city-settlement\",\n        geoLocation: false,\n        onSelect: enforceCity,\n        onSelectNothing: enforceCity,\n        formatSelected: formatCitySelected\n    });\n\n    $address.suggestions({\n        token: token,\n        type: type,\n        onSelect: restrictAddressValue,\n        formatSelected: formatSelected\n    });\n\n    \/\/ \u0415\u0441\u043b\u0438 \u043d\u0430 \u043f\u043e\u043b\u0435 \u0430\u0434\u0440\u0435\u0441 \u0435\u0441\u0442\u044c \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043f\u043e\u043b\u044f\n    var p = $postcode.val() || \"\";\n    var a = $address.val() || \"\";\n      \n    $city.on(\"suggestions-fixdata\",\n      function(e, suggestion) {\n        \/\/console.log(suggestion);\n        $address.val(a);\n      \t$postcode.val(p)\n      }\n    );\n\n    $city.suggestions().fixData();\n\n    function setConstraints(sgt, kladr_id) {\n        var restrict_value = false;\n        var locations = null;\n        if (kladr_id) {\n            locations = {\n                kladr_id: kladr_id\n            };\n            restrict_value = true;\n        }\n        sgt.setOptions({\n            constraints: {\n                locations: locations\n            },\n            restrict_value: restrict_value\n        });\n    }\n\n    function enforceCity(suggestion) {\n        var sgt = $address.suggestions();\n        sgt.clear();\n        if (suggestion) {\n            setConstraints(sgt, suggestion.data.kladr_id);\n            formatRegion(suggestion.data);\n        } else {\n            setConstraints(sgt, null);\n        }\n    }\n\n    function formatCitySelected(suggestion) {\n        var address = suggestion.data;\n        if (address.city_with_type === address.region_with_type) {\n            return address.settlement || address.city || \"\";\n        } else {\n            return join([\n                address.city,\n                address.settlement\n            ]);\n        }\n    }\n\n    function formatRegion(address) {\n        $postcode.val(address.postal_code || '');\n        if ($region.length) {\n            var result = address.region.replace(\/\\s{0,1}[-\\\/].+\/gi, '').toLowerCase();\n            $region.find('option').each(function (i, o) {\n                if ($(o).text().toLowerCase().search(result) \u003E= 0) $(this).attr('selected', true);\n                else $(this).attr('selected', false);\n            });\n        }\n    }\n\n    function restrictAddressValue(suggestion) {\n        var citySgt = $city.suggestions();\n        var addressSgt = $address.suggestions();\n        if (!citySgt.currentValue) {\n            citySgt.setSuggestion(suggestion);\n            var city_kladr_id = suggestion.data.kladr_id.substr(0, 13);\n            setConstraints(addressSgt, city_kladr_id);\n        }\n    }\n\n    function formatSelected(suggestion) {\n        var addressValue = makeAddressString(suggestion.data);\n        return addressValue;\n    }\n\n    function makeAddressString(address) {\n        formatRegion(address);\n\n        return join([\n            address.street_with_type,\n            join([address.house_type, address.house,\n                address.block_type, address.block\n            ], \" \"),\n            join([address.flat_type, address.flat], \" \")\n        ]);\n    }\n\n    function join(arr \/*, separator *\/ ) {\n        var separator = arguments.length \u003E 1 ? arguments[1] : \", \";\n        return arr.filter(function (n) {\n            return n\n        }).join(separator);\n    }\n}\n\/\/ \u0414\u043b\u044f \u0431\u043b\u043e\u043a\u0430 \u0430\u0434\u0440\u0435\u0441\u0441 \u0431\u0435\u0440\u0435\u043c \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043d\u0443\u0436\u043d\u044b\u0435 \u0438\u043d\u043f\u0443\u0442\u044b\nvar $city = $('#shipping_address_city');\nvar $address = $('#shipping_address_address_1');\nvar $postcode = $('#shipping_address_postcode');\nvar $zoneId = $('#shipping_address_zone_id');\n\/\/ \u0414\u043b\u044f \u0431\u043b\u043e\u043a\u0430 \u0430\u0434\u0440\u0435\u0441\u0441 \u0432\u044b\u0437\u043e\u0432\ncheckAddress($city, $address, $postcode, $zoneId);\n\n\/\/ \u0414\u043b\u044f \u0431\u043b\u043e\u043a\u0430 \u0438\u043c\u0435\u043d\u0438, \u0444\u0430\u043c\u0438\u043b\u0438\u044f\nfunction initName($surname, $name) {\n    \/\/ \u0415\u0441\u043b\u0438 \u0438\u043d\u043f\u0443\u0442\u0430 \u0444\u0430\u043c\u0438\u043b\u0438\u044f \u0438\u043b\u0438 \u0438\u043c\u044f \u043d\u0435\u0442\u0443, \u0432\u044b\u0445\u043e\u0434\u0438\u043c\n    if (!$surname.length || !$name.length) return;\n    var self = {};\n    self.$surname = $surname;\n    self.$name = $name;\n    var fioParts = [\"SURNAME\", \"NAME\"];\n    $.each([$surname, $name], function (index, $el) {\n        var sgt = $el.suggestions({\n            token: token,\n            type: \"NAME\",\n            triggerSelectOnSpace: false,\n            hint: \"\",\n            noCache: true,\n            params: {\n                \/\/ \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u043f\u043e\u043b\u044e --- \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0430\u044f \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0430\n                parts: [fioParts[index]]\n            }\n        });\n    });\n};\n\/\/ \u0414\u043b\u044f \u0431\u043b\u043e\u043a\u0430 \u0438\u043c\u0435\u043d\u0438, \u0444\u0430\u043c\u0438\u043b\u0438\u044f \u0432\u044b\u0437\u043e\u0432\nvar $surname = $(\"#shipping_address_lastname\");\nvar $name = $(\"#shipping_address_firstname\");\n\ninitName($surname, $name);\n\n\/\/ \u0414\u043b\u044f \u0431\u043b\u043e\u043a\u0430 email \u0441 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u043e\u0439 \u0435\u0441\u0442\u044c \u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0439 \u0438\u043d\u043f\u0443\u0442\nvar $email = $(\"#customer_email\");\nif ($email.length) {\n    $email.suggestions({\n        token: token,\n        type: \"EMAIL\",\n    });\n}","after":"","css":"","status":1}