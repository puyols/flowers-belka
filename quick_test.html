<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç API - Flowers Belka</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .status.online { background: #d4edda; color: #155724; }
        .status.offline { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üß™ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —É–ª—É—á—à–µ–Ω–∏–π Flowers Belka</h1>
    
    <div class="container">
        <h2>üîç –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–æ–≤</h2>
        <div id="server-status">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        <button onclick="checkServers()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—ã</button>
    </div>

    <div class="container">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h2>
        <p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PHP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080</p>
        
        <button onclick="testAPI('products', '–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤')">–¢–æ–≤–∞—Ä—ã</button>
        <button onclick="testAPI('categories', '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏')">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        <button onclick="testAPI('stats', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button onclick="testAPI('search&q=—Ä–æ–∑–∞', '–ü–æ–∏—Å–∫')">–ü–æ–∏—Å–∫ "—Ä–æ–∑–∞"</button>
        <button onclick="testAPI('price_range', '–î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω')">–¶–µ–Ω—ã</button>
        <button onclick="testAdvancedProducts()">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</button>
        
        <div id="api-result" class="result">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
    </div>

    <div class="container">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="test-summary">
            <p>–¢–µ—Å—Ç—ã –µ—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å</p>
        </div>
    </div>

    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            tests: []
        };

        async function checkServers() {
            const statusDiv = document.getElementById('server-status');
            statusDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä—ã...';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º PHP —Å–µ—Ä–≤–µ—Ä (API)
            try {
                const response = await fetch('http://localhost:8080/api_products.php?action=stats', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="status online">‚úÖ PHP —Å–µ—Ä–≤–µ—Ä (API): –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8080</div>
                    `;
                } else {
                    throw new Error('Server responded with error');
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status offline">‚ùå PHP —Å–µ—Ä–≤–µ—Ä (API): –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080</div>
                    <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: <code>php -S localhost:8080</code></p>
                `;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Next.js —Å–µ—Ä–≤–µ—Ä
            try {
                const response = await fetch('http://localhost:3001', {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                statusDiv.innerHTML += `
                    <div class="status online">‚úÖ Next.js —Å–µ—Ä–≤–µ—Ä: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3001</div>
                `;
            } catch (error) {
                statusDiv.innerHTML += `
                    <div class="status offline">‚ùå Next.js —Å–µ—Ä–≤–µ—Ä: –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3001</div>
                    <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ó–∞–ø—É—Å—Ç–∏—Ç–µ: <code>cd flowers-belka-nextjs && npm run dev</code></p>
                `;
            }
        }

        async function testAPI(action, description) {
            const resultDiv = document.getElementById('api-result');
            resultDiv.className = 'result';
            resultDiv.textContent = `–¢–µ—Å—Ç–∏—Ä—É–µ–º: ${description}...`;
            
            const url = `http://localhost:8080/api_products.php?action=${action}`;
            
            try {
                const startTime = Date.now();
                const response = await fetch(url);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                const data = await response.json();
                
                if (response.ok && (data.success !== false)) {
                    resultDiv.className = 'result success';
                    
                    let summary = `‚úÖ ${description} - –£—Å–ø–µ—à–Ω–æ (${responseTime}ms)\n\n`;
                    
                    if (data.products) {
                        summary += `üì¶ –¢–æ–≤–∞—Ä–æ–≤: ${data.products.length}\n`;
                        if (data.pagination) {
                            summary += `üìÑ –°—Ç—Ä–∞–Ω–∏—Ü: ${data.pagination.pages}\n`;
                        }
                    } else if (data.categories) {
                        summary += `üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: ${data.categories.length}\n`;
                    } else if (data.stats) {
                        summary += `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n`;
                        Object.entries(data.stats).forEach(([key, value]) => {
                            if (Array.isArray(value)) {
                                summary += `  ${key}: ${value.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n`;
                            } else {
                                summary += `  ${key}: ${value}\n`;
                            }
                        });
                    } else if (data.results) {
                        summary += `üîç –ù–∞–π–¥–µ–Ω–æ: ${data.results.length} —Ç–æ–≤–∞—Ä–æ–≤\n`;
                    } else if (data.price_range) {
                        summary += `üí∞ –¶–µ–Ω—ã: ${data.price_range.min} - ${data.price_range.max} —Ä—É–±.\n`;
                    }
                    
                    resultDiv.textContent = summary + '\n–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:\n' + JSON.stringify(data, null, 2);
                    
                    testResults.passed++;
                    testResults.tests.push({name: description, status: 'passed', time: responseTime});
                } else {
                    throw new Error(data.error || 'API returned error');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}\n\nURL: ${url}`;
                
                testResults.failed++;
                testResults.tests.push({name: description, status: 'failed', error: error.message});
            }
            
            updateTestSummary();
        }

        async function testAdvancedProducts() {
            await testAPI('products&page=1&limit=5&sort=price_asc&min_price=1000&max_price=5000', '–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤');
        }

        function updateTestSummary() {
            const summaryDiv = document.getElementById('test-summary');
            const total = testResults.passed + testResults.failed;
            
            let html = `
                <h3>üìä –°–≤–æ–¥–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <p><strong>–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${total}</p>
                <p><strong>–£—Å–ø–µ—à–Ω–æ:</strong> <span style="color: green;">${testResults.passed}</span></p>
                <p><strong>–û—à–∏–±–æ–∫:</strong> <span style="color: red;">${testResults.failed}</span></p>
                
                <h4>–î–µ—Ç–∞–ª–∏:</h4>
                <ul>
            `;
            
            testResults.tests.forEach(test => {
                const icon = test.status === 'passed' ? '‚úÖ' : '‚ùå';
                const time = test.time ? ` (${test.time}ms)` : '';
                const error = test.error ? ` - ${test.error}` : '';
                html += `<li>${icon} ${test.name}${time}${error}</li>`;
            });
            
            html += '</ul>';
            
            if (total > 0) {
                const successRate = Math.round((testResults.passed / total) * 100);
                html += `<p><strong>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:</strong> ${successRate}%</p>`;
                
                if (successRate >= 80) {
                    html += '<p style="color: green;">üéâ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.</p>';
                } else if (successRate >= 60) {
                    html += '<p style="color: orange;">‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –Ω–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç.</p>';
                } else {
                    html += '<p style="color: red;">üö® –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.</p>';
                }
            }
            
            summaryDiv.innerHTML = html;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            setTimeout(checkServers, 1000);
        };
    </script>
</body>
</html>
